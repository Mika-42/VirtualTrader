<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="index.css">
    <title>Title</title>
</head>
<body>
<main>
    <header id="info">
        <h2 id="date" class="user-data">01/2042</h2>
        <h2 id="username" class="user-data">Foo</h2>
        <h2 id="balance-account" class="user-data">10 000.00€</h2>
    </header>
    <canvas id="graph"></canvas>
</main>
<aside id="action-panel">
</aside>
</body>

<script>
    const newAction = (parentId, id, name, code, price, description, evolution) => {
            let el = document.createElement('div');
            el.className = 'action';
            el.id = id;

            el.innerHTML = `
                <div class="action-name">${name}</div>
                <div class="action-code">(${code})</div>
                <div class="action-price">${price}€</div>
                <div class="action-price-evolution">${(evolution >= 0) ? '+' : '-'}${Math.abs(evolution) + '%'}</div>
                <div class="action-description">${description}</div>
                <button class="action-buy" title="buy"></button>
                <button disabled class="action-sell" title="sell"></button>`;

            let p = document.getElementById(parentId);
            p.appendChild(el);

        }

    const pid = 'action-panel';

    newAction(pid, 'apple-action', 'Apple Inc.', 'AAPL', 5, 'Technologie, fabricant de produits électroniques.', 5);
    newAction(pid, 'tesla-action', 'Tesla Inc.', 'TSLA', 10, 'Automobile, spécialisé dans les véhicules électriques.', 2);
    newAction(pid, 'amazon-action', 'Amazon.com Inc.', 'AMZN', 7, 'E-commerce, services cloud.', -1);
    newAction(pid, 'microsoft-action', 'Microsoft Corp.', 'MSFT', 15, 'Technologie, logiciels et services cloud.', 1.5);
    newAction(pid, 'alphabet-action', 'Alphabet Inc.', 'GOOGL', 5.5, 'Secteur technologique, maison-mère de Google.', -2);
    newAction(pid, 'cocacola-action', 'Coca-Cola Co.', 'KO', 4.1, 'Boissons non alcoolisées.', 3);
    newAction(pid, 'nike-action', 'Nike Inc.', 'KO', 8, 'Vêtements et équipements sportifs.', -3.8);
    newAction(pid, 'intel-action', 'Intel Corp.', 'INTC', 8, 'Fabricant de processeur et semi-conducteurs.', 1.5);
    newAction(pid, 'boeing-action', 'Boeing Co.', 'BA', 5, 'Aéronautique et défense.', 1.5);
    newAction(pid, 'visa-action', 'Visa Inc.', 'V', 6, 'Services financiers et paiements électroniques.', 4);
    </script>

<script>
    const balanceAccount = document.getElementById('balance-account');
    let balanceAccountValue = 10000.00; // todo get this value from php !

    const ids = ['apple-action', 'tesla-action', 'amazon-action', 'microsoft-action', 'alphabet-action', 'cocacola-action', 'nike-action', 'intel-action', 'boeing-action', 'visa-action',];
    for(const id of ids)
    {
        const btnSell = document.querySelector(`#${id} .action-sell`);
        const btnBuy = document.querySelector(`#${id} .action-buy`);

        /**
         * todo get this from php
         * query the good id then access to name in html
         * check if the name match with name in table
        */
        let price = document.querySelector(`#${id} .action-price`).innerHTML;

        btnSell.addEventListener('click', () => {
            btnSell.disabled = true;
            btnBuy.disabled = false;
            balanceAccountValue += parseFloat(price);
            console.log(balanceAccountValue)
            const formatedIntValue = new Intl.NumberFormat('fr-FR').format(parseInt(balanceAccountValue));
            const decimalValue = balanceAccountValue.toFixed(2).split('.')[1];
            balanceAccount.innerText =  `${formatedIntValue}.${decimalValue}€`;
        });

        btnBuy.addEventListener('click', () => {
            btnSell.disabled = false;
            btnBuy.disabled = true;

            balanceAccountValue -= parseFloat(price);
            console.log(balanceAccountValue)
            const formatedIntValue = new Intl.NumberFormat('fr-FR').format(parseInt(balanceAccountValue));
            const decimalValue = balanceAccountValue.toFixed(2).split('.')[1];
            balanceAccount.innerText =  `${formatedIntValue}.${decimalValue}€`;
        })
    }

</script>
</html>